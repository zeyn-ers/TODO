<div class="layout">

  <!-- HEADER (Notion page header: emoji + title) -->
  <header class="page-head">
    <button class="emoji-btn" (click)="emojiPickerFor.set('page')">{{ pageIcon() }}</button>
    <input class="title-input"
           [value]="pageTitle()"
           (input)="saveTitle($any($event.target).value)"
           placeholder="Untitled" />
    <div class="head-tools">
      <input class="search" placeholder="Ara..." [value]="q()" (input)="q.set($any($event.target).value)" />
      <button class="btn accent" (click)="addTodo()">+ Yeni</button>
    </div>

    <!-- emoji picker (page) -->
    <div class="emoji-pop" *ngIf="emojiPickerFor()==='page'">
      <div class="emoji-grid">
        <button *ngFor="let e of emojiPalette" (click)="setPageIcon(e)">{{e}}</button>
      </div>
      <button class="close" (click)="emojiPickerFor.set(null)">‚úï</button>
    </div>
  </header>

  <div class="grid">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sb-header">
        <div class="label">Kategoriler</div>
        <span class="muted">{{ categories().length }} adet</span>
      </div>

      <div class="sb-add">
        <input class="input" placeholder="Yeni kategori..." [formControl]="catForm.controls.name" />
        <button class="btn" (click)="addCategory()">Ekle</button>
      </div>

      <ul class="cat-list">
        <li class="cat" [class.active]="selectedCatId()==='all'" (click)="pickCat('all')">
          <span class="dot all"></span> T√ºm√º
        </li>

        <li class="cat" *ngFor="let c of categories()" [class.active]="selectedCatId()===c.id">
          <button class="emoji-btn small" (click)="emojiPickerFor.set(c.id); $event.stopPropagation()">
            {{ iconForCategory(c.id) }}
          </button>
          <span class="name" (click)="pickCat(c.id)">{{ c.name }}</span>

          <!-- emoji picker (category) -->
          <div class="emoji-pop" *ngIf="emojiPickerFor()===c.id">
            <div class="emoji-grid">
              <button *ngFor="let e of emojiPalette" (click)="setCatIcon(c.id, e)">{{e}}</button>
            </div>
            <button class="close" (click)="emojiPickerFor.set(null)">‚úï</button>
          </div>
        </li>
      </ul>

      <hr class="sep" />
      <div class="muted small">
        Solda filtre, saƒüda i√ßerik. Notion-style ü™Ñ
      </div>
    </aside>

    <!-- CONTENT -->
    <section class="content">
      <!-- Quick add row -->
      <div class="quick">
        <input class="input w" placeholder="Ba≈ülƒ±k" [formControl]="todoForm.controls.title" />
        <input class="input w" placeholder="A√ßƒ±klama" [formControl]="todoForm.controls.description" />
        <select class="input" [formControl]="todoForm.controls.categoryId">
          <option value="all">Kategori yok</option>
          <option *ngFor="let c of categories()" [value]="c.id">
            {{ iconForCategory(c.id) }} {{ c.name }}
          </option>
        </select>
        <input class="input" type="date" [formControl]="todoForm.controls.dueDate" />
        <button class="btn" (click)="addTodo()">Ekle</button>
      </div>

      <!-- List (block-style) -->
      <div class="table">
        <div class="thead">
          <div>Durum</div>
          <div>Ba≈ülƒ±k</div>
          <div>Kategori</div>
          <div>Son Tarih</div>
          <div class="right">ƒ∞≈ülem</div>
        </div>

        <div class="row" *ngFor="let t of filtered()">
          <div>
            <input type="checkbox" [checked]="t.isCompleted" (change)="toggleDone(t)" />
          </div>
          <div class="title-cell">
            <div class="t">{{ t.title }}</div>
            <div class="d muted" *ngIf="t.description">{{ t.description }}</div>
          </div>
          <div>
            <span class="pill" *ngIf="t.categoryId as cid; else noCat">
              {{ iconForCategory(cid) }} {{ catNameById(cid) }}
            </span>
            <ng-template #noCat><span class="muted">‚Äî</span></ng-template>
          </div>
          <div>
            <span class="muted" *ngIf="!t.dueDate">‚Äî</span>
            <span *ngIf="t.dueDate as d">{{ d | date:'dd.MM.yyyy' }}</span>
          </div>
          <div class="right">
            <button class="btn" (click)="removeTodo(t)">Sil</button>
          </div>
        </div>

        <div class="empty muted" *ngIf="filtered().length===0">
          Hi√ß kayƒ±t yok. √ústteki ‚ÄúYeni‚Äù ile hƒ±zlƒ±ca ekleyebilirsin.
        </div>
      </div>
    </section>
  </div>
</div>
